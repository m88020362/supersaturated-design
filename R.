#SCAD Screening Active Effect
##########################################
install.packages("ncvreg")
library(ncvreg)

# 手動生成設計矩陣 (14 runs 和 24 factors)
H_half <- matrix(c(
  1,  1,  1,  1,  1, -1, -1, -1, -1, -1, -1, -1,  1, -1,
  1, -1,  1, -1,  1, -1, -1, -1, -1,  1, -1,  1,  1, -1,
  1,  1, -1,  1,  1, -1, -1, -1, -1, -1,  1,  1, -1, -1,
  1, -1,  1,  1,  1, -1,  1, -1, -1,  1, -1, -1,  1, -1,
  -1,  1,  1, -1, -1,  1,  1, -1,  1, -1, -1,  1, -1,  1,
  -1, -1, -1,  1, -1,  1,  1,  1,  1,  1, -1, -1, -1, -1,
  1,  1, -1, -1,  1, -1, -1,  1,  1, -1, -1, -1, -1, -1,
  1, -1, -1,  1, -1,  1,  1, -1, -1, -1, -1, -1,  1, -1,
  -1,  1, -1,  1, -1,  1, -1, -1, -1, -1,  1,  1, -1, -1,
  1, -1, -1, -1,  1, -1,  1,  1,  1, -1, -1,  1, -1, -1,
  1,  1,  1, -1, -1,  1, -1,  1, -1,  1, -1, -1,  1,  1,
  -1,  1, -1, -1,  1, -1,  1, -1, -1, -1, -1,  1, -1,  1,
  -1,  1,  1,  1, -1,  1,  1, -1,  1,  1, -1, -1, -1, -1,
  1, -1, -1, -1, -1,  1, -1,  1, -1,  1, -1, -1,  1, -1,
  1,  1, -1, -1, -1, -1,  1, -1, -1,  1, -1,  1,  1,  1,
  -1,  1, -1,  1,  1, -1, -1, -1,  1, -1, -1,  1,  1, -1,
  -1, -1,  1, -1,  1, -1, -1,  1, -1, -1,  1, -1,  1,  1,
  1,  1, -1,  1,  1, -1,  1, -1, -1, -1,  1, -1, -1,  1,
  -1, -1, -1,  1, -1,  1, -1, -1,  1, -1,  1,  1, -1, -1,
  1, -1, -1,  1,  1, -1, -1,  1, -1,  1, -1,  1, -1,  1,
  -1,  1,  1, -1, -1,  1,  1, -1,  1,  1,  1, -1,  1, -1,
  1,  1,  1, -1,  1, -1,  1, -1,  1, -1,  1,  1,  1,  1,
  1,  1, -1, -1, -1,  1, -1, -1,  1,  1, -1, -1, -1,  1,
  -1,  1, -1, -1,  1, -1,  1,  1,  1, -1, -1,  1, -1,  1), nrow=24, byrow=TRUE)

# 響應變量
y <- c(133, 62, 45, 52, 56, 47, 88, 193, 32, 53, 276, 145, 130, 127)

# 構建數據框
data <- data.frame(H_half, y)

# 為變數設置列名
colnames(data) <- c(paste("X", 1:14, sep=""), "response")

# 提取設計矩陣和響應變量
X <- as.matrix(data[, 1:14])
y <- data$response

# 使用 GCV 進行 SCAD 懲罰回歸
fit <- ncvreg(X, y, penalty="SCAD")

# 使用 GCV 選擇最佳 lambda
cvfit <- cv.ncvreg(X, y, penalty="SCAD", method="GCV")


# 最佳 lambda
lambda <- cvfit$lambda.min
print(lambda)

# 獲取最佳 lambda 下的模型係數
beta <- coef(cvfit, lambda=lambda)
print(beta)

# 活躍的變數
selected_vars <- which(beta != 0)
print(selected_vars)

# example2 3 cases(not used...)
beta_case1 <- c(10, rep(0, 23))
beta_case2 <- c(-15, 0, 0, 0, 8, rep(0, 3), -2, rep(0, 14))
beta_case3 <- c(-15, 0, 0, 0, 12, rep(0, 3), -8, rep(0, 3), 6, rep(0, 3), -2, rep(0, 6))


beta_list <- list(beta_case1, beta_case2, beta_case3)
